# render.yaml
services:
  - type: web
    name: pigeon-backend
    env: python
   buildCommand: |
  echo "ğŸš€ Ğ—ĞĞŸĞ£Ğ¡Ğš Ğ¡Ğ‘ĞĞ ĞšĞ˜ PIGEON MESSENGER"
  echo "=================================="
  
  # 0. Ğ¡ĞĞœĞĞ• Ğ’ĞĞ–ĞĞĞ•: Ğ˜ÑĞ¿Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ’Ğ¡Ğ• Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ñ‹ CustomUser
  echo "ğŸ”§ Ğ˜Ğ¡ĞŸĞ ĞĞ’Ğ›Ğ•ĞĞ˜Ğ• Ğ’Ğ¡Ğ•Ğ¥ Ğ˜ĞœĞŸĞĞ Ğ¢ĞĞ’..."
  python fix_all_imports.py
  
  # 1. Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ñ€Ğ°Ğ±Ğ¾Ñ‡Ğ¸Ğ¹ users/admin.py
  echo "ğŸ› ï¸  Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ users/admin.py Ğ´Ğ»Ñ Render..."
  cat > users/admin.py << 'EOF'
  # users/admin.py - Ğ’Ğ•Ğ Ğ¡Ğ˜Ğ¯ Ğ”Ğ›Ğ¯ RENDER
  
  # ĞĞ˜Ğ§Ğ•Ğ“Ğ ĞĞ• Ğ”Ğ•Ğ›ĞĞ•Ğœ!
  # ĞœĞ¾Ğ´ĞµĞ»ÑŒ User ÑƒĞ¶Ğµ Ğ·Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ° Django Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸
  # Ğ›ÑĞ±Ğ°Ñ Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚ĞºĞ° admin.site.register() Ğ²Ñ‹Ğ·Ğ¾Ğ²ĞµÑ‚ Ğ¾ÑˆĞ¸Ğ±ĞºÑƒ
  
  print("âœ… ĞĞ´Ğ¼Ğ¸Ğ½ĞºĞ°: Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ğ°Ñ Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ auth.User")
  EOF
  
  # 2. Ğ£ÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸
  echo "ğŸ“¦ Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹..."
  pip install --upgrade pip
  pip install django==5.2.3
  pip install gunicorn==21.2.0
  pip install whitenoise==6.6.0
  pip install psycopg2-binary==2.9.9
  pip install dj-database-url==2.1.0
  pip install djangorestframework==3.15.2
  pip install django-cors-headers==4.3.1
  
  # 3. Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµĞ¼ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸
  echo "ğŸ”„ Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¹..."
  python manage.py migrate --noinput
  
  # 4. Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ ÑÑƒĞ¿ĞµÑ€Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
  echo "ğŸ‘‘ Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ ÑÑƒĞ¿ĞµÑ€Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ..."
  echo "from django.contrib.auth.models import User; User.objects.create_superuser('admin', 'admin@example.com', 'admin123') if not User.objects.filter(username='admin').exists() else print('âœ… Ğ¡ÑƒĞ¿ĞµÑ€Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ ÑƒĞ¶Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚')" | python manage.py shell
  
  # 5. Ğ¡Ğ¾Ğ±Ğ¸Ñ€Ğ°ĞµĞ¼ ÑÑ‚Ğ°Ñ‚Ğ¸ĞºÑƒ
  echo "ğŸ“¦ Ğ¡Ğ±Ğ¾Ñ€ĞºĞ° ÑÑ‚Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ñ… Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²..."
  python manage.py collectstatic --noinput --clear