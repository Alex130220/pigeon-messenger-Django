services:
  - type: web
    name: pigeon-backend
    env: python
  buildCommand: |
  echo "üöÄ –ù–ê–ß–ê–õ–û –°–ë–û–†–ö–ò..."
  echo "=================="
  
  # 1. –û–±–Ω–æ–≤–ª—è–µ–º pip
  pip install --upgrade pip
  
  # 2. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ú–ò–ù–ò–ú–ê–õ–¨–ù–´–ï –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
  echo "üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π..."
  pip install django==5.2.3
  pip install gunicorn==21.2.0
  pip install whitenoise==6.6.0
  pip install psycopg2-binary==2.9.9
  pip install dj-database-url==2.1.0
  
  # 3. –ó–ê–ü–£–°–ö–ê–ï–ú –ù–ê–® –°–ö–†–ò–ü–¢ –ú–ò–ì–†–ê–¶–ò–ò
  echo "üõ†Ô∏è  –ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞ –º–∏–≥—Ä–∞—Ü–∏–∏..."
  python migrate_all.py
  
  # 4. –ü—Ä–æ–±—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏ Django (–Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π)
  echo "üîÑ –ü—Ä–æ–±—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏ Django..."
  python manage.py makemigrations --noinput || echo "‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏"
  python manage.py migrate --noinput || echo "‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏"
  
  # 5. –°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
  echo "üìÅ –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π..."
  mkdir -p static/css static/js static/images
  mkdir -p staticfiles
  mkdir -p media
  mkdir -p sessions
  
  # 6. –°–æ–∑–¥–∞–µ–º –±–∞–∑–æ–≤—ã–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
  echo "üé® –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤..."
  echo "/* –ë–∞–∑–æ–≤—ã–µ —Å—Ç–∏–ª–∏ */ body { margin: 0; padding: 20px; font-family: sans-serif; }" > static/css/style.css
  echo "console.log('App loaded');" > static/js/main.js
  echo "placeholder" > static/images/Pigeon.png
  
  # 7. –°–æ–±–∏—Ä–∞–µ–º —Å—Ç–∞—Ç–∏–∫—É
  echo "üìä –°–±–æ—Ä–∫–∞ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤..."
  python manage.py collectstatic --noinput --clear
  
  echo "‚úÖ –°–ë–û–†–ö–ê –ó–ê–í–ï–†–®–ï–ù–ê!"
  echo "=================="
    startCommand: gunicorn pigeon.wsgi:application --bind 0.0.0.0:$PORT
    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: pigeon-db
          property: connectionString
      - key: SECRET_KEY
        generateValue: true
      - key: DEBUG
        value: false
      - key: PYTHON_VERSION
        value: 3.11.0
      - key: DISABLE_COLLECTSTATIC
        value: 0
    autoDeploy: true

databases:
  - name: pigeon-db
    databaseName: pigeon
    user: pigeon_user
    plan: free